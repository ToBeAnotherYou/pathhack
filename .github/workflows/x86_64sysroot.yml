name: Build x86_64 sysroot for SSLVPNClient

on:
  push:
  workflow_dispatch:

jobs:
  build-sysroot:
    runs-on: ubuntu-22.04  # x86_64 runner

    steps:
      # 1️⃣ Checkout 仓库
      - name: Checkout code
        uses: actions/checkout@v4

      # 2️⃣ 安装必要工具
      - name: Install build tools
        run: |
          sudo apt-get update -qq
          sudo apt-get install -y --no-install-recommends \
            debootstrap \
            qemu-user-static \
            binutils \
            tar \
            gzip

      # 3️⃣ 创建 x86_64 sysroot
      - name: Build x86_64 sysroot
        run: |
          SYSROOT_DIR="$PWD/sysroot"
          sudo rm -rf "$SYSROOT_DIR"
          mkdir -p "$SYSROOT_DIR"
          # debootstrap 构建 x86_64 Ubuntu 20.04
          sudo debootstrap --arch=amd64 focal "$SYSROOT_DIR" http://archive.ubuntu.com/ubuntu
          # 修复权限
          sudo chown -R $USER:$USER "$SYSROOT_DIR"
          # 查看目录结构
          ls -l "$SYSROOT_DIR"

      # 4️⃣ 上传 artifact
      - name: Upload x86_64 sysroot
        uses: actions/upload-artifact@v4
        with:
          name: x86_64-sysroot
          path: sysroot
